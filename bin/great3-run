#!/usr/bin/env python
"""
    %prog [options] config
"""

import sys
import yaml
import fitsio

import great3
from great3 import files

from optparse import OptionParser
parser=OptionParser(__doc__)

parser.add_option('--obj-range',default=None,
                  help="obj range as csv")

def get_obj_range(options):
    obj_range=options.obj_range
    if obj_range is not None:
        obj_range=[int(v) for v in obj_range.split(',')]

    return obj_range

def main():
    options,args = parser.parse_args(sys.argv[1:])

    if len(args) < 1:
        parser.print_help()
        sys.exit(45)

    config_file = args[0]
    conf=yaml.load(open(config_file))

    conf['obj_range']=get_obj_range(options)

    rg=great3.rg.RGFitter(**conf)
    rg.go()

    data=rg.get_data()

    outfile=files.get_output_file(**conf)
    print outfile
    stop
    fitsio.write(outfile, data, clobber=True)

main()
